# 本地调试命令记录

## 运行环境
golang:1.24

alpine:3.22.1

## 构建镜像调试

修改镜像构建文件，先拉取go语言依赖，利用docker缓存机制，设置加速，设置启动命令。

创建调试目录
```bash
mkdir -p ts-调试
```

### 服务端

```bash
mkdir -p ts-调试/frps && touch ts-调试/frps/frps.toml && touch ts-调试/frps/compose.yaml
```

#### 构建服务端镜像

```bash
docker buildx build --file dockerfiles/Dockerfile-for-frps \
--platform linux/amd64 --tag firfe/frps:0.65.0 \
--output type=docker .
```

#### 运行镜像测试

##### 配置文件 frps.toml

```toml
# frps.toml - 服务端配置
# 基础配置
## frps 服务端-客户端 通讯端口
bindPort = 7000

# 安全配置
[auth]
method = "token"
## 请修改为复杂密码
token = "frps"

# Web 管理界面
[webServer]
addr = "0.0.0.0"
## 管理界面端口
port = 7500
user = "frps"
password = "frps"

# 日志配置
[log]
to = "./frps.log"
level = "info"
maxDays = 7

```

##### 部署文件 compose.yaml

```yaml
name: frps
services:
  frps:
    container_name: frps
    image: firfe/frps:0.65.0
    network_mode: host
    tty: true
    stdin_open: true
    environment:
      TZ: Asia/Shanghai
      TIME_ZONE: Asia/Shanghai
    volumes:
      - ./frps.toml:/etc/frp/frps.toml

```

### 客户端

```bash
mkdir -p ts-调试/frpc && touch ts-调试/frpc/frpc.toml && touch ts-调试/frpc/compose.yaml
```

#### 构建服务端镜像

```bash
docker buildx build --file dockerfiles/Dockerfile-for-frpc \
--platform linux/amd64 --tag firfe/frpc:0.65.0 \
--output type=docker .
```

#### 运行镜像测试

##### 配置文件 frpc.toml

```toml
serverAddr = "127.0.0.1"
serverPort = 7000

auth.method = "token" 
auth.token = "frps"

# 网页界面
webServer.addr = "0.0.0.0"
webServer.port = 7400
webServer.user = "frps"
webServer.password = "frps"
webServer.pprofEnable = false

# 测试
[[proxies]]
name = "测试"
type = "tcp"
# 本地ip
localIP = "127.0.0.1"
# 本地 端口
localPort = 2345
# 远程端口，不写动态分配
remotePort = 1212

```

##### 部署文件 compose.yaml

```yaml
name: frpc
services:
  frpc:
    container_name: frpc
    image: firfe/frpc:0.65.0
    network_mode: host
    tty: true
    stdin_open: true
    environment:
      TZ: Asia/Shanghai
      TIME_ZONE: Asia/Shanghai
    volumes:
      - ./frpc.toml:/etc/frp/frpc.toml

```

## 最终构建镜像

### 服务端

#### AMD64

```bash
docker buildx build --file dockerfiles/Dockerfile-for-frps \
--platform linux/amd64 --tag firfe/frps:0.65.0 \
--output type=docker .
```

#### ARM64

```bash
docker buildx build --file dockerfiles/Dockerfile-for-frps \
--platform linux/arm64 --tag firfe/frps:0.65.0-arm64 \
--output type=docker .
```

### 客户端

#### AMD64

```bash
docker buildx build --file dockerfiles/Dockerfile-for-frpc \
--platform linux/amd64 --tag firfe/frpc:0.65.0 \
--output type=docker .
```

#### ARM64

```bash
docker buildx build --file dockerfiles/Dockerfile-for-frpc \
--platform linux/arm64 --tag firfe/frpc:0.65.0-arm64 \
--output type=docker .
```
